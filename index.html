<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>üéÑChristmas Tree MusicüéÑ</title>
  <style>
    #content {
        position: relative;
        z-index: 1;
        text-align: center;
    }

    #snow-container{
        position: fixed;
        inset: 0;
        pointer-events: none;
        overflow: hidden;
        z-index: 0;
    }

    .snowflake {
        position: absolute;
        top: -10px;
        color: white;
        opacity: 0.8;
        user-select: none;
        animation-name: snow-fall;
        animation-timing-function: linear;
        animation-iteration-count: 1;
    }

    .top-star {
      color: goldenrod;
      font-size: 28px;
      text-shadow: 0 0 8px rgba(255, 255, 200, 0.9);
      animation: top-star-twinkle 2s ease-in-out infinite;
    }


    @keyframes snow-fall {
        0% {
            transform: translateY(0);
        }
        100% {
            transform: translateY(110vh);
        }
    }

    @keyframes top-star-twinkle {
      0%, 100% {
        transform: scale(1);
        opacity: 0.7;
      }
      50% {
        transform: scale(1.2);
        opacity: 1;
      }
    }


    @media (max-width: 600px) {
      #tree {
        font-size: 16px;
      }
      #controls button {
        display: block;
        width: 80%;
        margin: 6px auto;
      }
    }

    @keyframes tree-glow {
      0%, 100% {
        filter: brightness(1);
      }
      50% {
        filter: brightness(1.3);
      }
    }

    @keyframes playing-pulse {
      0% {
        transform: translateY(-2px) scale(1.03);
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.7), 0 0 18px rgba(255, 255, 255, 0.3);
      }
      100% {
        transform: translateY(-3px) scale(1.08);
        box-shadow: 0 0 18px rgba(255, 255, 255, 1), 0 0 32px rgba(255, 255, 255, 0.7);
      }
    }

    body {
      background: #000;
      color: #fff;
      font-family: "Consolas", "Courier New", monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 40px;
    }
    h1 {
      margin-bottom: 10px;
    }
    #tree {
      white-space: nowrap;
      line-height: 1.1;
      font-size: 20px;
      font-family: 'Courier New', "Consolas", monospace;
      display: inline-block;
      text-align: left;
      margin-top: 16px;
      animation: tree-glow 3s ease-in-out infinite;
    }
    #now-playing{
      margin-top: 10px;
      font-size: 16px;
    }
    #controls {
      margin-bottom: 20px;
    }
    button {
      margin: 4px;
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }

    .playing-btn {
      position: relative;
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 0 14px rgba(255, 255, 255, 0.9), 0 0 26px rgba(255, 255, 255, 0.5);
      filter: brightness(1.25);
      animation: playing-pulse 0.8s ease-in-out infinite alternate;
    }

    .playing-btn::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 2px solid rgba(255, 255, 255, 0.7);
      box-shadow: 0 0 18px rgba(255, 255, 200, 0.9);
      pointer-events: none;
      
    }

    .song-btn {
      color: #fff;
      border: none;
      font-weight: 500;
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.15s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.35);
    }

    .song-btn:active {
      transform: translateY(2px) scale(0.97);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
      filter: brightness(0.95);
    }

    .song-jingle {background: #f84e27;}
    .song-lastChristmas {background: #ff9d13;}
    .song-allIWant {background: #ffde39;}
    .song-tree {background: #1bc808b6;}
    .song-weWish {background: #1f6ce0;}
    .song-noel {background: #7a30e1;}
    .song-default{background: #f16fbd;}

    .song-btn:hover {
      filter: brightness(1.15);
    }

  </style>
</head>
<body>
  <div id = "content">
    <h1>üéÑLittle PresentüéÑ</h1>
    <pre id="tree"></pre>
    <div id = "now-playing">Any music is playing now...</div>
    <div id="controls">
      <button class = "song-btn song-jingle" data-song="jingle" data-label="Jingle Bells">Jingle Bells</button>
      <button class = "song-btn song-lastChristmas" data-song="lastChristmas" data-label="Last Christmas">Last Christmas</button>
      <button class = "song-btn song-allIWant" data-song="allIWant" data-label="All I Want For Christmas">All I Want For Christmas</button>
      <button class = "song-btn song-tree" data-song="tree" data-label="Oh Christmas Tree">Oh Christmas Tree</button>
      <button class = "song-btn song-weWish" data-song="weWish" data-label="We Wish You A Merry Christmas">We Wish You a Merry Christmas</button>
      <button class = "song-btn song-noel" data-song="noel" data-label="Noel">Noel</button>
      <button class = "song-btn song-default" data-song="default" data-label="???">Guess the song</button>
    </div>
  </div>

  <button id="fire-btn">üî•</button>
  <button id="pause-btn">‚èØ</button>

  <div id = "snow-container"></div>

  <audio id="fire-audio" src="sound/fire-crackling-sounds.mp3" loop></audio>

  <script>

    const COLORS = [
      "red",
      "limegreen",
      "gold",
      "magenta",
      "cyan",
      "orangered",
      "lightgreen",
      "khaki",
      "dodgerblue",
    ];

    const treeEl = document.getElementById("tree");
    const TREE_HEIGHT = 8;
    let treeInterval = null;

    function randomRainbowLine(starCount) {
      const coloredCount = Math.floor(Math.random() * starCount) + 1;
      const indices = new Set();
      while (indices.size < coloredCount) {
        indices.add(Math.floor(Math.random() * starCount));
      }

      const ornaments = ["‚ú¶", "‚ú∂", "‚ú∫", "‚Ä¢"];

      const chars = [];
      for (let i = 0; i < starCount; i++) {
        const isColored = indices.has(i);
        const color = COLORS[Math.floor(Math.random() * COLORS.length)];

        const isOrnament = Math.random() < 0.12;

        if (isColored && isOrnament) {
          const ch = ornaments[Math.floor(Math.random() * ornaments.length)];
          chars.push(
            `<span class="ornament" style="color:${color}">${ch}</span>`
          );
        } else if (isColored) {
          chars.push(
            `<span class="tree-star" style="color:${color}">*</span>`
          );
        } else {
          chars.push(`<span class="tree-star">*</span>`);
        }
      }
      return chars.join("");
    }

    function drawRainbowTree() {
      let html = "";

      const topSpaces = "&nbsp;".repeat(TREE_HEIGHT - 1);
      html += topSpaces + `<span class="top-star">‚òÖ</span><br>`;

      for (let i = 1; i <= TREE_HEIGHT; i++) {
        const spaces = "&nbsp;".repeat(TREE_HEIGHT - i);
        const starCount = 2 * i - 1;
        const stars = randomRainbowLine(starCount);
        html += spaces + stars + "<br>";
      }

      const baseStarCount = 2 * TREE_HEIGHT -1;
      const trunWidth = 3;
      const trunkSpaces = Math.floor((baseStarCount - trunWidth) / 2);

      for (let i = 0; i < 3; i++) {
        const spaces = "&nbsp;".repeat(trunkSpaces);
        html +=
          spaces + `<span style="color:green">|||</span>` + "<br>";
      }
      treeEl.innerHTML = html;
    }

    function startTreeAnimation() {
      stopTreeAnimation();
      drawRainbowTree();
      treeInterval = setInterval(drawRainbowTree, 200);
    }

    function stopTreeAnimation() {
      if (treeInterval) {
        clearInterval(treeInterval);
        treeInterval = null;
      }
    }


    const NOTE_FREQS = {
      C4: 262,
      D4: 294,
      E4: 330,
      F4: 349,
      "F#5": 743,
      G4: 392,
      A4: 440,
      "A#5": 936,
      B4: 494,
      C5: 523,
      "C#5": 555,
      D5: 587,
      E5: 659,
      F5: 698,
      G5: 784,
      A5: 880,
      B5: 988,
      C6: 1047,
      D6: 1188,
    };

    const MELODIES = {
      jingle: [
        ["E5", 300], ["E5", 300], ["E5", 600],
        ["E5", 300], ["E5", 300], ["E5", 600],
        ["E5", 300], ["G5", 300], ["C5", 400], ["D5", 150], ["E5", 900],
        ["pause", 400],
        ["F5", 300], ["F5", 300], ["F5", 500], ["F5", 150],
        ["F5", 300], ["E5", 300], ["E5", 300], ["E5", 300],
        ["E5", 400], ["D5", 300], ["D5", 300], ["E5", 300],
        ["D5", 600], ["G5", 600],
        ["E5", 300], ["E5", 300], ["E5", 600],
        ["E5", 300], ["E5", 300], ["E5", 600],
        ["E5", 300], ["G5", 300], ["C5", 400], ["D5", 150], ["E5", 900],
        ["pause", 400],
        ["F5", 300], ["F5", 300], ["F5", 500], ["F5", 150],
        ["F5", 400], ["E5", 300], ["E5", 300], ["E5", 300],
        ["G5", 300], ["G5", 300], ["F5", 300], ["D5", 300], ["C5", 400],
      ],

      lastChristmas: [
        ["G5", 500], ["G5", 300], ["F5", 400], ["pause", 100],
        ["C5", 300], ["G5", 400], ["G5", 400], ["A5", 400], ["F5", 700],
        ["pause", 400],
        ["C5", 300], ["G5", 400], ["G5", 400], ["A5", 500], ["F5", 700],
        ["pause", 300],
        ["C5", 300], ["pause", 100], ["E5", 300], ["F5", 300], ["E5", 300], ["D5", 600],
        ["pause", 700],
        ["A5", 900], ["G5", 900], ["pause", 300],
        ["D5", 300], ["pause", 100], ["A5", 300], ["A#5", 300], ["A5", 300], ["G5", 900],
        ["pause", 400],
        ["F5", 300], ["E5", 400], ["F5", 400], ["F5", 400], ["E5", 600],
        ["pause", 200],
        ["F5", 500], ["pause", 200], ["E5", 400], ["C5", 900],
      ],

      allIWant: [
        ["G5", 400], ["A5", 400], ["F#5", 400], ["G5", 400],
        ["E5", 200], ["F#5", 400], ["E5", 200], ["D5", 400], ["pause", 300],
        ["G5", 400], ["A5", 400], ["F#5", 400], ["G5", 400],
        ["E5", 200], ["F#5", 400], ["E5", 200], ["D5", 400], ["pause", 500],
        ["C5", 400], ["D5", 400], ["F5", 300], ["C6", 400], ["A#5", 700],
        ["pause", 1000],
        ["A5", 500], ["G5", 500], ["F5", 500], ["D5", 500], ["C#5", 500],
        ["G5", 800], ["A5", 700], ["G5", 600], ["F5", 700],
      ],

      tree: [
        ["C5", 500], ["F5", 400], ["F5", 200], ["F5", 500], ["pause", 200],
        ["G5", 400], ["A5", 400], ["A5", 200], ["A5", 500], ["pause", 200],
        ["A5", 200], ["G5", 200], ["A5", 200], ["A#5", 400],
        ["E5", 400], ["G5", 400], ["F5", 400], ["pause", 300],

        ["C5", 500], ["F5", 400], ["F5", 200], ["F5", 500], ["pause", 200],
        ["G5", 400], ["A5", 400], ["A5", 200], ["A5", 400], ["pause", 200],
        ["A5", 200], ["G5", 200], ["A5", 200], ["A#5", 400],
        ["E5", 400], ["G5", 400], ["F5", 500], ["pause", 300],

        ["C6", 400], ["C6", 300], ["A5", 300], ["D6", 500],
        ["C6", 300], ["C6", 300], ["A#5", 300], ["A#5", 600], ["pause", 300],
        ["A#5", 400], ["A#5", 300], ["G5", 300], ["C6", 500],
        ["A#5", 300], ["A#5", 300], ["A5", 300], ["A5", 600], ["pause", 300],

        ["C5", 500], ["F5", 400], ["F5", 200], ["F5", 500], ["pause", 200],
        ["G5", 400], ["A5", 400], ["A5", 200], ["A5", 400], ["pause", 200],
        ["A5", 200], ["G5", 200], ["A5", 200], ["A#5", 400],
        ["E5", 400], ["G5", 500], ["F5", 700],
      ],

      weWish: [
        ["C5", 500], ["F5", 500], ["F5", 300], ["G5", 300],
        ["F5", 300], ["E5", 300], ["D5", 500], ["D5", 500], ["pause", 200],
        ["D5", 500], ["G5", 500], ["G5", 300], ["A5", 300],
        ["G5", 300], ["F5", 300], ["E5", 500], ["C5", 500], ["pause", 200],
        ["C5", 500], ["A5", 500], ["A5", 300], ["A#5", 300],
        ["A5", 300], ["G5", 300], ["F5", 500], ["D5", 500],
        ["C5", 200], ["C5", 200],
        ["D5", 500], ["G5", 500], ["E5", 500], ["F5", 500],
      ],

      noel: [
        ["E5", 400], ["D5", 400], ["C5", 900], ["D5", 300],
        ["E5", 300], ["F5", 400], ["G5", 900],
        ["pause", 500],
        ["A5", 400], ["B5", 400], ["C6", 700], ["B5", 700],
        ["A5", 700], ["G5", 700],
        ["pause", 600],
        ["A5", 400], ["B5", 400], ["C6", 700], ["B5", 700],
        ["A5", 700], ["G5", 700],
        ["A5", 700], ["B5", 700], ["C6", 700], ["G5", 700],
        ["F5", 700], ["E5", 1000],
      ],

      default: [
        ["C6", 500], ["A#5", 200], ["A5", 400], ["G5", 400],
        ["F5", 400], ["G5", 400], ["A5", 400], ["F5", 400],
        ["G5", 200], ["A5", 200], ["A#5", 200], ["G5", 200],
        ["A5", 500], ["G5", 300], ["F5", 500], ["E5", 500], ["F5", 700],
        ["pause", 300],
        ["C6", 500], ["A#5", 200], ["A5", 400], ["G5", 400],
        ["F5", 400], ["G5", 400], ["A5", 400], ["F5", 400],
        ["D6", 200], ["D6", 200], ["D6", 200], ["D6", 200],
        ["C6", 600], ["A#5", 300], ["A5", 400], ["G5", 400], ["F5", 700],
      ],
    };

    let isPlaying = false;
    let isPaused = false;
    let currentSongLabel = "";
    let playToken = 0;

    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function sleep(ms) {
      return new Promise((resolve) => setTimeout(resolve, ms));
    }

    function playTone(freq, durMs, volume = 0.3) {
      return new Promise((resolve) => {
        if (freq == null) {
          setTimeout(resolve, durMs);
          return;
        }
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();

        osc.type = "sine";
        osc.frequency.value = freq;
        gain.gain.value = volume;

        osc.connect(gain);
        gain.connect(audioCtx.destination);

        osc.start();
        setTimeout(() => {
          osc.stop();
          resolve();
        }, durMs);
      });
    }


    async function playMelody(melody) {
      const myToken = ++playToken;
      isPlaying = true;
      isPaused = false;
      startTreeAnimation();
      
      for (const [note, dur] of melody) {
        if (myToken !== playToken) {
          return;
        }

        while (isPaused) {
          await sleep(80);
          if (myToken !== playToken) {
            return;
          }
        }

        if (note === "pause") {
          await playTone(null, dur);
        } else {
          const freq = NOTE_FREQS[note] || 600;
          await playTone(freq, dur);
        }
      }
      if (myToken === playToken) {
        stopTreeAnimation();
        isPlaying = false;
        nowPlayingEl.textContent = "Song Ended...";
        currentSongLabel = "";
        pauseBtn.textContent = "‚è∏";
        isPaused = false;
      }
    }

    const nowPlayingEl = document.getElementById("now-playing");
    const pauseBtn = document.getElementById("pause-btn");
    const controlsEl = document.getElementById("controls");
    let currentSongButton = null;

    controlsEl.addEventListener("click", async(e) => {
      if (e.target.tagName !== "BUTTON") return;

      const btn = e.target;
      const key = btn.dataset.song;
      const label = btn.dataset.label || btn.textContent;
      const melody = MELODIES[key] || MELODIES.default;

      const expectedToken = playToken + 1;


      if (currentSongButton) {
        currentSongButton.classList.remove("playing-btn");
      }
      currentSongButton = btn;
      currentSongButton.classList.add("playing-btn");

      currentSongLabel = label;
      isPaused = false;
      pauseBtn.textContent = "‚è∏";

      nowPlayingEl.textContent = `Now Playing... ${label} üéµ`;

      await audioCtx.resume();
      await playMelody(melody);

      if (playToken === expectedToken && currentSongButton === btn && !isPaused){
        currentSongButton.classList.remove("playing-btn");
        currentSongButton = null;
      }
    });


    const snowContainer = document.getElementById("snow-container");

    function createSnowflake(){
        const span = document.createElement("span");
        span.className = "snowflake";
        span.textContent = "‚úª"

        span.style.left = Math.random() * 100 + "vw";
        span.style.fontSize = 8 + Math.random() * 16 + "px";
        const duration = 5 + Math.random() * 5;
        span.style.animationDuration = duration + "s";

        snowContainer.appendChild(span);

        setTimeout(() => {
            span.remove();
        }, duration * 1000);
    }

    pauseBtn.addEventListener("click", () => {
      if (!isPlaying) return;

      isPaused = !isPaused;

      if (isPaused) {
        pauseBtn.textContent = "‚ñ∂";
        stopTreeAnimation();
        if (currentSongLabel) {
          nowPlayingEl.textContent = `Paused: ${currentSongLabel} ‚è∏`;
        } else {
          nowPlayingEl.textContent = "‚è∏";
        }
      } else {
        pauseBtn.textContent = "‚è∏";
        if (currentSongLabel) {
          nowPlayingEl.textContent = `Now Playing... ${currentSongLabel} üéµ`
        }
        startTreeAnimation();
      }
    })

    setInterval(createSnowflake, 200);

    const fireAudio = document.getElementById("fire-audio");
    const fireBtn = document.getElementById("fire-btn");
    let fireOn = false;

    // Ïû•Ïûë ÏÜåÎ¶¨ Í∏∞Î≥∏ ÏùåÎüâ 0 ~ 1.0
    fireAudio.volume = 0.5;

    fireBtn.addEventListener("click", async () => {
      if (!fireOn) {
        try {
          await fireAudio.play();
          fireOn = true;
          fireBtn.textContent = "üî• stop";
        } catch (err) {
          console.error("Fire audio play error: ", err);
        }
      } else {
        fireAudio.pause();
        fireOn = false;
        fireBtn.textContent = "üî•";
      }
    });

    drawRainbowTree();
  </script>
</body>
</html>
